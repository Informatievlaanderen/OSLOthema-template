name: Validate JSONs

on: [push]

jobs:
  fetch-configuration-files:
    runs-on: ${{ matrix.os }}
    strategy:
      matrix:
        os: [ubuntu-latest]
        # Different Node versions. Each node version will trigger the action
        node-version:
          - 18.x
    steps:
      - name: Check out repository
        uses: actions/checkout@v4
        with:
          repository: ${{ github.repository }}
          ref: config
          path: Informatievlaanderen/OSLOthema-template

      - name: Copy schema and configuration file
        shell: bash
        run: |
          git config user.name github-actions
          git config user.email github-actions@github.com
          ls -al
          ls -al
  verify-json-validation:
    # Wait for previous job to make sure the schemas folder and configuration schema are created before running this job
    needs: fetch-configuration-files
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          # needed to fetch changes from other jobs, otherwise working on initial repo state
          ref: ${{ github.ref }}
          fetch-depth: 0
      - name: Validate JSON
        uses: docker://orrosenblatt/validate-json-action:latest
        env:
          INPUT_SCHEMA: https://raw.githubusercontent.com/Informatievlaanderen/OSLOthema-template/config/schemas/configuration.json
          INPUT_JSONS: https://raw.githubusercontent.com/Informatievlaanderen/OSLOthema-airAndWater/master/config/OSLO-AirAndWater-Water-AP.json
